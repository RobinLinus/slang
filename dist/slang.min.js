"use strict";function Imag(){}function I(){}function Lex(){}function match(e,n){try{return Lex.empty(e)||Lex.empty(n)?!1:(e=Seman.present(e),n=Seman.present(n),e.calc()==n.calc()?!0:(e=e.simplify(3),n=n.simplify(3),console.log(e.string()+"=="+n.string()),e.string()==n.string()))}catch(t){return!1}}function matchSyntax(e,n){try{return Lex.empty(e)||Lex.empty(n)?!1:(e=Syntax.present(e),n=Syntax.present(n),Syntax.string(e)==Syntax.string(n))}catch(t){return!1}}function matchApprox(e,n,t){"number"==typeof e&&(e=""+e),"number"==typeof n&&(n=""+n);try{return Lex.empty(e)||Lex.empty(n)?!1:(e=Seman.present(e).calc(),n=Seman.present(n).calc(),isNaN(e)||isNaN(n)?!1:Math.abs(e-n)<=t)}catch(t){return!1}}function matchDebug(e){console.log("======================================"),e=Syntax.present(e),console.log(Syntax.string(e)),e=Seman.represent(e),console.log(e.string()),console.log("======================================"),e=e.expand(),console.log(e.string()),e=e.combine(),console.log(e.string()),e=e.expow(),console.log(e.string()),console.log("--------------------------------------"),e=e.expand(),console.log(e.string()),e=e.combine(),console.log(e.string()),e=e.expow(),console.log(e.string()),console.log("--------------------------------------"),e=e.expand(),console.log(e.string()),e=e.combine(),console.log(e.string()),e=e.expow(),console.log(e.string()),console.log("======================================")}function Seman(){}function Syntax(){}function Imag(){}function I(){}function Lex(){}function match(e,n){try{return Lex.empty(e)||Lex.empty(n)?!1:(e=Seman.present(e),n=Seman.present(n),e.calc()==n.calc()?!0:(e=e.simplify(3),n=n.simplify(3),console.log(e.string()+"=="+n.string()),e.string()==n.string()))}catch(t){return!1}}function matchSyntax(e,n){try{return Lex.empty(e)||Lex.empty(n)?!1:(e=Syntax.present(e),n=Syntax.present(n),Syntax.string(e)==Syntax.string(n))}catch(t){return!1}}function matchApprox(e,n,t){"number"==typeof e&&(e=""+e),"number"==typeof n&&(n=""+n);try{return Lex.empty(e)||Lex.empty(n)?!1:(e=Seman.present(e).calc(),n=Seman.present(n).calc(),isNaN(e)||isNaN(n)?!1:Math.abs(e-n)<=t)}catch(t){return!1}}function matchDebug(e){console.log("======================================"),e=Syntax.present(e),console.log(Syntax.string(e)),e=Seman.represent(e),console.log(e.string()),console.log("======================================"),e=e.expand(),console.log(e.string()),e=e.combine(),console.log(e.string()),e=e.expow(),console.log(e.string()),console.log("--------------------------------------"),e=e.expand(),console.log(e.string()),e=e.combine(),console.log(e.string()),e=e.expow(),console.log(e.string()),console.log("--------------------------------------"),e=e.expand(),console.log(e.string()),e=e.combine(),console.log(e.string()),e=e.expow(),console.log(e.string()),console.log("======================================")}function Seman(){}function Syntax(){}window.Slang=window.Slang||{},window.Slang.colorslang={compare:function(e,n){return console.log(this.rgbToHex(n)),e===this.rgbToHex(n)},_hexToRgb:function(e){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},rgbToHex:function(e){return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)}},window.Slang=window.Slang||{},window.Slang.colorslang={compare:function(e,n){return console.log(this.rgbToHex(n)),e===this.rgbToHex(n)},_hexToRgb:function(e){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},rgbToHex:function(e){return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)}},window.Slang=window.Slang||{},window.Slang.hausdorffslang={compare:function(e,n,t,r,i){var s=this._normalize(e,n,t,r,i);return 1-Math.max(this._maxeuclideanDistance(s.X,s.Y),this._maxeuclideanDistance(s.Y,s.X))},_euclideanDistance:function(e,n){var t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)},_minEuclideanDistance:function(e,n){var t=this;return n.reduce(function(n,r){var i=t._euclideanDistance(e,r);return n>i?i:n},1/0)},_maxeuclideanDistance:function(e,n){var t=this;return e.reduce(function(e,r){var i=t._minEuclideanDistance(r,n);return i>e?i:e},0)},_calcRelativeOrigin:function(e){var n=e.reduce(function(e,n){return{x0:e.x0+n.x,y0:e.y0+n.y}},{x0:0,y0:0});return n.x0/=e.length,n.y0/=e.length,n},_centerSet:function(e,n,t,r){var i=t?n.x0:0,s=r?n.y0:0;return e.map(function(e){return{x:e.x-i,y:e.y-s}})},_calcBoundingBox:function(e){return e.reduce(function(e,n){return{xmax:Math.max(n.x,e.xmax),xmin:Math.min(n.x,e.xmin),ymax:Math.max(n.y,e.ymax),ymin:Math.min(n.y,e.ymin)}},{xmax:-(1/0),ymax:-(1/0),xmin:1/0,ymin:1/0})},_boundingBoxSet:function(e,n,t,r){var i=Math.abs(n.xmax-n.xmin),s=Math.abs(t.xmax-t.xmin),a=Math.abs(n.ymax-n.ymin),u=Math.abs(t.ymax-t.ymin),o=s/i,c=u/a,f=2*o*c/(o+c);return e.map(function(e){return{x:r.x0+(r.x0-e.x)/f,y:r.y0+(r.y0-e.y)/f}})},_normalize:function(e,n,t,r,i){if(t||r||i){var s=this._calcRelativeOrigin(e),a=this._calcRelativeOrigin(n);if(i){var u=this._calcBoundingBox(e),o=this._calcBoundingBox(n);n=this._boundingBoxSet(n,u,o,a)}(t||r)&&(e=this._centerSet(e,s,t,r),n=this._centerSet(n,a,t,r))}return{X:e,Y:n}}},window.Slang=window.Slang||{},window.Slang.hausdorffslang={compare:function(e,n,t,r,i){var s=this._normalize(e,n,t,r,i);return 1-Math.max(this._maxeuclideanDistance(s.X,s.Y),this._maxeuclideanDistance(s.Y,s.X))},_euclideanDistance:function(e,n){var t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)},_minEuclideanDistance:function(e,n){var t=this;return n.reduce(function(n,r){var i=t._euclideanDistance(e,r);return n>i?i:n},1/0)},_maxeuclideanDistance:function(e,n){var t=this;return e.reduce(function(e,r){var i=t._minEuclideanDistance(r,n);return i>e?i:e},0)},_calcRelativeOrigin:function(e){var n=e.reduce(function(e,n){return{x0:e.x0+n.x,y0:e.y0+n.y}},{x0:0,y0:0});return n.x0/=e.length,n.y0/=e.length,n},_centerSet:function(e,n,t,r){var i=t?n.x0:0,s=r?n.y0:0;return e.map(function(e){return{x:e.x-i,y:e.y-s}})},_calcBoundingBox:function(e){return e.reduce(function(e,n){return{xmax:Math.max(n.x,e.xmax),xmin:Math.min(n.x,e.xmin),ymax:Math.max(n.y,e.ymax),ymin:Math.min(n.y,e.ymin)}},{xmax:-(1/0),ymax:-(1/0),xmin:1/0,ymin:1/0})},_boundingBoxSet:function(e,n,t,r){var i=Math.abs(n.xmax-n.xmin),s=Math.abs(t.xmax-t.xmin),a=Math.abs(n.ymax-n.ymin),u=Math.abs(t.ymax-t.ymin),o=s/i,c=u/a,f=2*o*c/(o+c);return e.map(function(e){return{x:r.x0+(r.x0-e.x)/f,y:r.y0+(r.y0-e.y)/f}})},_normalize:function(e,n,t,r,i){if(t||r||i){var s=this._calcRelativeOrigin(e),a=this._calcRelativeOrigin(n);if(i){var u=this._calcBoundingBox(e),o=this._calcBoundingBox(n);n=this._boundingBoxSet(n,u,o,a)}(t||r)&&(e=this._centerSet(e,s,t,r),n=this._centerSet(n,a,t,r))}return{X:e,Y:n}}},window.Slang=window.Slang||{},window.Slang.langslang={compare:function(e,n){return Slang.logicslang.compare(e,n,this._compare)},_compare:function(e,n){if(e=e.trim(),n=n.trim(),0!==e.indexOf("#"))return e==n;var t=e.substr(1,e.indexOf(" ")-1);return e=e.substr(e.indexOf(" ")+1),"typo"==t?Slang.langslang._isTypo(e.toLowerCase(),n.toLowerCase()):"nocase"==t?e.toLowerCase()==n.toLowerCase():"regex"==t?(e=new RegExp(e),e.test(n)):void 0},_isTypo:function(e,n){var t=Slang.langslang._damerauLevenshtein(e,n);return t<Math.ceil(Math.sqrt(e.length)-1)?!0:!1}},window.Slang.langslang._damerauLevenshtein=function(e,n){var t=[];if(e==n)return 0;if(0==e.length)return n.length;if(0==n.length)return e.length;for(var r=0;r<e.length+1;r++){t[r]=[];for(var i=0;i<n.length+1;i++)0==r||0==i?t[r][i]=Math.max(r,i):(t[r][i]=Math.min(t[r-1][i]+1,t[r][i-1]+1,t[r-1][i-1]+(e[r-1]==n[i-1]?0:1)),i>1&&r>1&&e[r-1]==n[i-2]&&e[r-2]==n[i-1]&&(t[r][i]=Math.min(t[r][i],t[r-2][i-2]+1)))}return t[e.length][n.length]},window.Slang=window.Slang||{},window.Slang.langslang={compare:function(e,n){return Slang.logicslang.compare(e,n,this._compare)},_compare:function(e,n){if(e=e.trim(),n=n.trim(),0!==e.indexOf("#"))return e==n;var t=e.substr(1,e.indexOf(" ")-1);return e=e.substr(e.indexOf(" ")+1),"typo"==t?Slang.langslang._isTypo(e.toLowerCase(),n.toLowerCase()):"nocase"==t?e.toLowerCase()==n.toLowerCase():"regex"==t?(e=new RegExp(e),e.test(n)):void 0},_isTypo:function(e,n){var t=Slang.langslang._damerauLevenshtein(e,n);return t<Math.ceil(Math.sqrt(e.length)-1)?!0:!1}},window.Slang.langslang._damerauLevenshtein=function(e,n){var t=[];if(e==n)return 0;if(0==e.length)return n.length;if(0==n.length)return e.length;for(var r=0;r<e.length+1;r++){t[r]=[];for(var i=0;i<n.length+1;i++)0==r||0==i?t[r][i]=Math.max(r,i):(t[r][i]=Math.min(t[r-1][i]+1,t[r][i-1]+1,t[r-1][i-1]+(e[r-1]==n[i-1]?0:1)),i>1&&r>1&&e[r-1]==n[i-2]&&e[r-2]==n[i-1]&&(t[r][i]=Math.min(t[r][i],t[r-2][i-2]+1)))}return t[e.length][n.length]},window.Slang=window.Slang||{},window.Slang.logicslang={compare:function(e,n,t,r){r&&(e=this.replaceVariables(e,r));var i=new LogicParser(t);return i.eval(e,n)},replaceVariables:function(e,n){for(var t in n){var r=new RegExp("@"+t,"g");e=e.replace(r,n[t])}return e}},window.LogicParser=function(e){this.compareFn=e,this.eval=function(e,n){return this.tokens=this.getTokens(e),this.givenValue=n,this.expression()},this.getTokens=function(e){var n=[];return n=e.split(/(#and|#or|#not|#var|<&|&|<|>)/),n=n.map(function(e){return e.trim()}),n=n.filter(function(e){return e.length>0})},this.expression=function(){if("#not"==this.tokens[0])return this.tokens.shift(),!this.terminal();var e=this.terminal();if("#and"==this.tokens[0]||"#or"==this.tokens[0]){var n=this.tokens.shift(),t=this.terminal();return"#and"==n?e&&t:e||t}return e},this.terminal=function(){var e=this.tokens.shift();if("<"==e){value=this.expression();var n=this.tokens.shift();if(">"!=n)throw"ERROR: Mismatched parentheses";return value}if("<&"==e){var t=this.givenValue;this.givenValue=this.tokens.shift();var r=this.tokens.shift();if("&"!=r)throw"ERROR: Mismatched &";value=this.expression();var n=this.tokens.shift();if(">"!=n)throw"ERROR: Mismatched parentheses";return this.givenValue=t,value}if(">"==e)throw"ERROR: Mismatched parentheses";return this.compareFn(e,this.givenValue)}},window.Slang=window.Slang||{},window.Slang.logicslang={compare:function(e,n,t,r){r&&(e=this.replaceVariables(e,r));var i=new LogicParser(t);return i.eval(e,n)},replaceVariables:function(e,n){for(var t in n){var r=new RegExp("@"+t,"g");e=e.replace(r,n[t])}return e}},window.LogicParser=function(e){this.compareFn=e,this.eval=function(e,n){return this.tokens=this.getTokens(e),this.givenValue=n,this.expression()},this.getTokens=function(e){var n=[];return n=e.split(/(#and|#or|#not|#var|<&|&|<|>)/),n=n.map(function(e){return e.trim()}),n=n.filter(function(e){return e.length>0})},this.expression=function(){if("#not"==this.tokens[0])return this.tokens.shift(),!this.terminal();var e=this.terminal();if("#and"==this.tokens[0]||"#or"==this.tokens[0]){var n=this.tokens.shift(),t=this.terminal();return"#and"==n?e&&t:e||t}return e},this.terminal=function(){var e=this.tokens.shift();if("<"==e){value=this.expression();var n=this.tokens.shift();if(">"!=n)throw"ERROR: Mismatched parentheses";return value}if("<&"==e){var t=this.givenValue;this.givenValue=this.tokens.shift();var r=this.tokens.shift();if("&"!=r)throw"ERROR: Mismatched &";value=this.expression();var n=this.tokens.shift();if(">"!=n)throw"ERROR: Mismatched parentheses";return this.givenValue=t,value}if(">"==e)throw"ERROR: Mismatched parentheses";return this.compareFn(e,this.givenValue)}},window.Slang=window.Slang||{},window.Slang.mathslang={compare:function(e,n,t){return Slang.logicslang.compare(e,n,this._compare,t)},_compare:function(e,n){n+="",e+="";if(n=n.trim(),e=e.trim(),0===e.indexOf("#")){var t=e.substr(1,e.indexOf(" ")-1);switch(e=e.substr(e.indexOf(" ")+1),t){case"equals":return match(e,n);case"identic":return matchSyntax(e,n);case"approx":var r=e.split("#epsilon");return matchApprox(r[0],n,r[1]);case"lt":return Number.parseFloat(n)<Number.parseFloat(e);case"leq":return Number.parseFloat(n)<=Number.parseFloat(e);case"gt":return Number.parseFloat(n)>Number.parseFloat(e);case"geq":return Number.parseFloat(n)>=Number.parseFloat(e);default:return e===n}}}},Imag.sort=function(e){var n=new I;return Object.keys(e).sort(function(e,n){return e.charCodeAt(0)-n.charCodeAt(0)}).forEach(function(t){n[t]=e[t]}),n},Imag.insert=function(e,n){Object.keys(n).forEach(function(t){e[t]?e[t]+=n[t]:e[t]=n[t],e[t]||delete e[t]})},Imag.clear=function(e){Object.keys(e).forEach(function(n){delete e[n]})},Imag.pow=function(e,n){Object.keys(e).forEach(function(t){n?e[t]*=n:delete e[t]})},Imag.akin=function(e,n){return Object.keys(e).toString()==Object.keys(n).toString()},Imag.equals=function(e,n){return JSON.stringify(e)==JSON.stringify(n)},Imag.empty=function(e){return 0==Object.keys(e).length},Imag.sortFunc=function(e,n){for(var t=Object.keys(e),r=Object.keys(n),i=Math.min(t.length,r.length),s=0;i>s;s++){if(t[s]<r[s])return-1;if(t[s]>r[s])return 1}var a=t.length-r.length;if(a)return a;for(var s=0;i>s;s++)if(a=e[t[s]]-n[r[s]])return a;return 0},Imag.strSortFunc=function(e,n){for(var t=Math.min(e.length,n.length),r=0;t>r;r++){if(e[r]<n[r])return-1;if(e[r]>n[r])return 1}return e.length-n.length},Imag.strSort=function(e){return e.split("").sort(function(e,n){return e.charCodeAt(0)-n.charCodeAt(0)}).reduce(function(e,n){return e+n},"")},Imag.strParse=function(e){for(var n=new I,t=0;t<e.length;t++){var r=e[t];n[r]?n[r]++:n[r]=1}return n},Imag.strValue=function(e){for(var n=1,t=0;t<e.length;t++)n*=e.charCodeAt(0);return n},Imag.len=function(e){return Object.keys(e).length},Imag.clone=function(e){return Object.keys(e).reduce(function(n,t){return n[t]=e[t],n},new I)},Imag.string=function(e){return Object.keys(e).reduce(function(n,t){var r=e[t];return n+(1==r?t:t+"^"+r)},"")},Lex.F={O:0,E:1,X:2,N:3,L:7},Lex.T=function(e,n){this.flag=e,this.code=n,this.inv=!1},Lex.G=function(e,n){this.exp=n,this.plu=e,this.test=function(e){return this.exp.test(e)}},Lex.SPAC=new Lex.G(!0,/^\s$/),Lex.BRAC=[new Lex.G(!1,/^\(|\[|\{$/),new Lex.G(!1,/^\)|\]|\}$/)],Lex.GRAM=[new Lex.G(!1,/^\+|\-|\*|\/$/),new Lex.G(!1,/^\^$/),new Lex.G(!1,/^[a-zA-Z]$/),new Lex.G(!0,/^[0-9]|\,|\.$/)],Lex.prep=function(e){return e=e.replace(/�/g,"^2"),e=e.replace(/�/g,"^3"),e=e.replace(/\u00B2/g,"^2"),e=e.replace(/\u00B3/g,"^3"),e=e.replace(/,/g,".")},Lex.iter=function(e){for(var n=[],t=this.prep(e).split("");t.length>0;){var r=0,i="";if(this.SPAC.test(t[0])){do t.shift();while(this.SPAC.test(t[0]))}else if(this.BRAC[0].test(t[0])){t.shift(),i="",r=this.F.L;for(var s=1,a="";s>0;){if(i+=a,0==t.length)throw")";a=t.shift(),s+=this.BRAC[0].test(a)?1:this.BRAC[1].test(a)?-1:0}n.push(new this.T(r,i))}else{for(;r<this.GRAM.length;){var u=this.GRAM[r];if(u.test(t[0]))do i=i.concat(t.shift());while(u.plu&&u.test(t[0]));i.length>0?(n.push(new this.T(r,i)),r=this.GRAM.length):r++}if(0==i.length)throw t.shift()}}return this.oper(n)},Lex.oper=function(e){var n=[],t=!1;for(var r in e){if(e[r].flag==this.F.O)switch(e[r].code){case"-":e[r].inv=!e[r].inv;case"+":break;case"/":t=!0;case"*":continue;default:throw"in `Lex.oper': Operator `"+e[r].code+"' has not been implemented."}else if(e[r].flag==this.F.E){if(0==n.length)throw"in `Lex.oper': Radix ahead `"+e[r].code+"' is undefined.";var i=n.pop();if(i.flag==this.F.O)throw"in `Lex.oper': Radix is not allowed to be an `"+i.code+"' operator.";e[r].code=i.code,e[r].inv=i.inv}else t&&(e[r].inv=!(t=!1));n.push(e[r])}return n},Lex.empty=function(e){for(var n=0;n<e.length;n++)if(!this.SPAC.test(e[n]))return!1;return!0},Seman.Q=function(e,n,t){this.fact=1,this.imag=new Object,this.sums=[],void 0!==e&&(this.fact*=e),void 0!==n&&(this.imag=n),void 0!==t&&(this.sums=t),this.calc=function(){return Seman.calcQ(this)},this.ident=function(){return Seman.identQ(this)},this.string=function(){return Seman.stringQ(this)},this.pow=function(e){return Seman.powQ(this,e)}},Seman.S=function(e,n,t){this.offset=0,this.queues=[],this.expont=null,void 0!==e&&(this.offset+=e),void 0!==n&&n.length>0&&(this.queues=n),void 0!==t&&(this.expont=t),this.calc=function(){return Seman.calc(this)},this.expand=function(){return Seman.expand(this),this},this.combine=function(){return Seman.combine(this)},this.expow=function(){return Seman.expow(this)},this.akinQ=function(){return Seman.akinS2Q(this)},this.ident=function(){return Seman.identS(this)},this.string=function(){return Seman.string(this)},this.simplify=function(e){return Seman.simplify(this,e)}},Seman.present=function(e){if("string"!=typeof e)throw"`Seman.present(string)' got `"+typeof e+"' instead of `string'";var n=Syntax.present(e);return this.represent(n)},Seman.represent=function(e){var n=new this.S;return e.forEach(function(e){var t=Seman.representQ(e);Seman.constQ(t)?n.offset+=t.fact:n.queues.push(t)}),this.solidify(n)},Seman.representQ=function(e){var n=new this.Q;return n.fact=e.fact.reduce(function(e,n){return e*n},1),n.imag=Imag.strParse(e.imag),e.exps.forEach(function(e){var t=Seman.represent(e.radix),r=Seman.represent(e.power),i=t.expont;if(t.expont=r,i){var s=new Seman.S;t.expont=i,s.expont=r,s.queues.push(new Seman.Q(1,new I,[t])),t=s}n.sums.push(t),console.log(t.string())}),e.sums.forEach(function(e){var t=Seman.represent(e);n.sums.push(t)}),n},Seman.constQ=function(e){return 0==Imag.len(e.imag)&&0==e.sums.length},Seman.solidify=function(e){var n=e.expont?e.expont.calc():NaN;return 0!=e.offset||1!=e.queues.length||1!=e.queues[0].fact||0!=e.queues[0].sums||isNaN(n)?e.queues.forEach(function(e){return e.sums.map(function(e){return Seman.solidify(e)})}):(Imag.pow(e.queues[0].imag,n),e.expont=null),0!=e.offset||1!=e.queues.length||e.expont||1!=e.queues[0].fact||0!=Imag.len(e.queues[0].imag)||1!=e.queues[0].sums.length?e:this.solidify(e.queues[0].sums[0])},Seman.solidifyQ=function(e){return 1!=e.fact||0!=Imag.len(e.imag)||1!=e.sums.length||0!=e.sums[0].offset||e.sums[0].expont||1!=e.sums[0].queues.length?e:this.solidifyQ(e.sums[0].queues[0])},Seman.calc=function(e){var n=e.offset+e.queues.reduce(function(e,n){return e+Seman.calcQ(n)},0);return e.expont?Math.pow(n,this.calc(e.expont)):n},Seman.calcQ=function(e){return Object.keys(e.imag).length>0?NaN:e.fact*e.sums.reduce(function(e,n){return e*Seman.calc(n)},1)},Seman.akinS2Q=function(e){return e.expont?0==e.offset&&1==e.queues.length?!0:0!=e.offset&&0==e.queues.length:!1},Seman.powQ=function(e,n){return new this.Q(Math.pow(e.fact,n),Object.keys(e.imag).reduce(function(t,r){return t[r]=e.imag[r]*n,t},new I))},Seman.identS=function(e){return 0==e.offset&&null==e.expont&&e.queues.length?!e.queues.some(this.calcQ):!1},Seman.identQ=function(e){return e.fact*e.sums.reduce(function(e,n){return e*n.calc()},1)==1&&Imag.empty(e.imag)},Seman.string=function(e){var n=e.expont?!0:!1;return e.queues.reduce(function(e,n){var t=n.string();return e+(n.fact<0?t:"+"+t)},(n?"(":"")+e.offset)+(n?")^("+e.expont.string()+")":"")},Seman.stringQ=function(e){return e.sums.reduce(function(e,n){return e+"("+n.string()+")"},""+e.fact+Imag.string(e.imag))},Seman.clone=function(e){var n=new Seman.S;return n.offset=e.offset,n.queues=e.queues.map(Seman.cloneQ),n.expont=e.expont?Seman.clone(e.expont):null,n},Seman.cloneQ=function(e){var n=new Seman.Q;return n.fact=e.fact,n.imag=Imag.clone(e.imag),n.sums=e.sums.map(Seman.clone),n},Seman.simplify=function(e,n){do e=e.expand(),e=e.combine(),e=e.expow();while(--n>0);return e},Seman.expand=function(e){for(var n=0;n<e.queues.length;){var t=Seman.extract(e.queues[n]);if(Imag.clear(e.queues[n].imag),e.queues[n].fact=1,e.queues[n].ident()){if(t.expont)throw"`expand': `s0.expont' must be `null'.";e.queues.splice(n,1),e.offset+=t.offset,e.queues=t.queues.concat(e.queues),n+=t.queues.length}else 1!=t.calc()&&e.queues[n].sums.push(t),n++}},Seman.extract=function(e){for(var n=new this.S(0,[new this.Q(e.fact,Imag.clone(e.imag))]),t=0;t<e.sums.length;)this.expand(e.sums[t]),null==e.sums[t].expont?(n=this.expansion(n,e.sums[t]),e.sums.splice(t,1)):t++;return n},Seman.expansion=function(e,n){if(null!=e.expont)throw"`expansion': `s0.expont != null'";if(null!=n.expont)throw"`expansion': `s1.expont != null'";var t=e.offset*n.offset,r=e.queues.map(function(e){return new Seman.Q(n.offset*e.fact,Imag.clone(e.imag),e.sums)}).concat(n.queues.map(function(n){return new Seman.Q(e.offset*n.fact,Imag.clone(n.imag),n.sums)}));return e.queues.forEach(function(e){n.queues.forEach(function(n){var t=new I;Imag.insert(t,e.imag),Imag.insert(t,n.imag),r.push(new Seman.Q(e.fact*n.fact,Imag.sort(t),e.sums.concat(n.sums)))})}),new this.S(t,r.filter(function(e){return 0!=e.fact}))},Seman.combine=function(e){var n=e.offset,t=[],r=void 0,i=e.expont;return i&&(i=this.combine(e.expont)),e.queues.filter(function(e){var t=Seman.calcQ(e);return isNaN(t)?!0:(n+=t,!1)}).map(function(e){return Seman.combineQ(e),e}).sort(function(e,n){return-Imag.sortFunc(e.imag,n.imag)}).forEach(function(e){void 0!=r&&Imag.equals(r.imag,e.imag)&&0==r.sums.length&&0==e.sums.length?t[0].fact+=e.fact:(t.unshift(e),r=e)}),t=t.filter(function(e){return 0!=e.fact}),Seman.solidify(new this.S(n,t,i))},Seman.combineQ=function(e){var n,t,r,i=[];n=e.sums.reduce(function(e,n,t){n=n.combine(n);var r=n.expont;n.expont=null;var i=Seman.string(n);return n.expont=r,e[i]?e[i].push(t):e[i]=[t],e},new Object),t=Object.keys(n);for(var s=0;s<t.length;s++)r=n[t[s]],r.length>1&&(i=i.concat(this.combineE(e.sums,r)));i.sort(function(e,n){return n-e}).forEach(function(n){e.sums.splice(n,1)})},Seman.combineE=function(e,n){if(n.length<2)throw"`combineE': "+n.length+"/2 indices";var t=[],r=new this.S,i=new this.S;for(i.offset=e[n[0]].offset,i.queues=e[n[0]].queues;n.length;){var s=e[n[0]].expont;s?s.expont?r.queues.push(new this.Q(1,new I,[s])):(r.offset+=s.offset,r.queues=r.queues.concat(s.queues)):r.offset++,t.push(n[0]),n.splice(0,1)}return i.expont=r,e.push(i),t},Seman.expow=function(e){e=Seman.powerfy(e);var n=e.expont?e.expont.calc():NaN;if(isNaN(n))e.expont&&e.expont.expont;else{for(var t=[];n>1;){var r=new Seman.S;r.offset=e.offset,r.queues=e.queues.map(Seman.cloneQ),t.push(r),n--}e.expont=1==n?null:new Seman.S(n),t.length&&(t.unshift(e),e=new Seman.S,e.queues.push(new Seman.Q(1,new I,t)))}return e.queues.forEach(function(e){e.sums=e.sums.map(Seman.expow)}),Seman.solidify(e)},Seman.powerfy=function(e){if(0==e.offset&&1==e.queues.length&&e.expont){for(var n=e.expont,t=e.queues[0],e=new this.S(0,[t]),r=0;r<t.sums.length;r++)t.sums[r].expont=Seman.expansion(t.sums[r].expont,Seman.clone(n));var i=n.calc();isNaN(i)?(t.sums.push(new this.S(t.fact,t.imag,Seman.clone(n))),t.fact=1,t.imag=new I):(t.fact=Math.pow(t.fact,i),Imag.pow(t.imag,i))}return e},Seman.concatS=function(e,n){return new this.S(e.offset+n.offset,e.queues.concat(n.queues))},Syntax.Q=function(){this.fact=[],this.imag="",this.exps=[],this.sums=[]},Syntax.E=function(){this.radix=[],this.power=[]},Syntax.present=function(e){if("string"!=typeof e)throw"`Syntax.present(string)' got `"+typeof e+"' instead of `string'";var n=Lex.iter(e),t=[];do{for(var r=!1;n.length>0&&n[0].flag==Lex.F.O;)n.shift().inv&&(r=!r);var i=this.pluckQ(n);i&&(r&&i.fact.unshift(-1),t.push(i))}while(n.length>0);return this.sort(t),t},Syntax.pluckQ=function(e){for(var n=new this.Q;e.length>0;)switch(e[0].flag){case Lex.F.N:var t=parseFloat(e[0].code);if(e.shift().inv){if(0==t)throw"`pluckQ' divided by 0.";t=1/t}n.fact.push(t);break;case Lex.F.X:var r=e[0].code;if(e.shift().inv){var i=new this.E;i.radix.push(this.X2Q(r)),i.power.push(this.N2Q(-1)),n.exps.push(i)}else n.imag+=r;break;case Lex.F.E:var i=new this.E;if(e[0].inv)throw"`pluckQ' Token `"+e[0]+"' is not allowed to be `inv'";i.radix=this.present(e.shift().code),i.power=this.pluckT(e),n.exps.push(i);break;case Lex.F.L:var s=this.present(e[0].code);if(e.shift().inv){var i=new this.E;i.radix=s,i.power.push(this.N2Q(-1)),n.exps.push(i)}else n.sums.push(s);break;case Lex.F.O:default:return this.emptyQ(n)?null:n}return this.emptyQ(n)?null:n},Syntax.pluckT=function(e){if(!(e.length>0))throw"`pluckT' without any token.";switch(e[0].flag){case Lex.F.N:return[this.N2Q(e.shift().code)];case Lex.F.X:return[this.X2Q(e.shift().code)];case Lex.F.E:var n=new this.E;if(e[0].inv)throw"`pluckT' Token `"+e[0]+"' is not allowed to be `inv'";return n.radix=this.present(e.shift().code),n.power=this.pluckT(e),[this.E2Q(n)];case Lex.F.L:return this.present(e.shift().code);case Lex.F.O:throw"`pluckT' invalid `flag=O'.";default:throw"`pluckT' invalid `flag=?'."}},Syntax.clean=function(e){e.forEach(Syntax.cleanQ)},Syntax.cleanQ=function(e){e.sums.forEach(Syntax.clean),e.exps.forEach(function(e){Syntax.clean(e.radix),Syntax.clean(e.power)});for(var n=0;n<e.exps.length;){var t=e.exps[n];1==t.radix.length&&1==t.power.length&&0==t.radix[0].fact.length&&t.radix[0].imag.length&&0==t.radix[0].exps.length&&0==t.radix[0].sums.length&&1==t.power.length&&1==t.power[0].fact.length&&!t.power[0].imag.length&&0==t.power[0].exps.length&&0==t.power[0].sums.length?e.exps.splice(n,1):n++}},Syntax.N2Q=function(e){var n=new this.Q;return n.fact.push(e),n},Syntax.X2Q=function(e){var n=new this.Q;return n.imag=e,n},Syntax.E2Q=function(e){var n=new this.Q;return n.exps.push(e),n},Syntax.sort=function(e){e.forEach(function(e){Syntax.sortQ(e)}),e.sort(function(e,n){return Imag.strSortFunc(e.imag,n.imag)})},Syntax.sortQ=function(e){e.sums.forEach(function(e){Syntax.sort(e)}),e.fact.sort(function(e,n){return e-n}),e.imag=Imag.strSort(e.imag),e.exps.sort(function(e,n){return Syntax.valueE(e)-Syntax.valueE(n)}),e.sums.sort(function(e,n){return Syntax.value(e)-Syntax.value(n)})},Syntax.value=function(e){return e.reduce(function(e,n){return e+Syntax.valueQ(n)},0)},Syntax.valueE=function(e){return Math.pow(16536421.3572347+this.value(e.radix),this.value(e.power))},Syntax.valueQ=function(e){return e.fact.reduce(function(e,n){return e*n},1)*Imag.strValue(e.imag)*e.exps.reduce(function(e,n){return e*Syntax.valueE(n)},1)*e.sums.reduce(function(e,n){return e*Syntax.value(n)},1)},Syntax.emptyQ=function(e){return 0==e.fact.length&&0==e.imag.length&&0==e.exps.length&&0==e.sums.length},Syntax.string=function(e){var n="";if(e.length){n+=this.stringQ(e[0]);for(var t=1;t<e.length;t++){var r=e[t].fact.reduce(function(e,n){return e*n},1),i=this.stringQ(e[t]);n+=0>r?i:"+"+i}}return n},Syntax.stringQ=function(e){var n="";if(e.fact.length){n+=e.fact[0];for(var t=1;t<e.fact.length;t++)n+="*"+e.fact[t]}return n+=e.imag,n+=e.exps.reduce(function(e,n){return e+Syntax.stringE(n)},""),n+=e.sums.reduce(function(e,n){return e+"("+Syntax.string(n)+")"},"")},Syntax.stringE=function(e){return"("+Syntax.string(e.radix)+")^("+Syntax.string(e.power)+")"},window.Slang=window.Slang||{},window.Slang.mathslang={compare:function(e,n,t){return Slang.logicslang.compare(e,n,this._compare,t)},_compare:function(e,n){if(n+="",e+="",n=n.trim(),e=e.trim(),0===e.indexOf("#")){var t=e.substr(1,e.indexOf(" ")-1);switch(e=e.substr(e.indexOf(" ")+1),t){case"equals":return match(e,n);case"identic":return matchSyntax(e,n);case"approx":var r=e.split("#epsilon");return matchApprox(r[0],n,r[1]);case"lt":return Number.parseFloat(n)<Number.parseFloat(e);case"leq":return Number.parseFloat(n)<=Number.parseFloat(e);case"gt":return Number.parseFloat(n)>Number.parseFloat(e);case"geq":return Number.parseFloat(n)>=Number.parseFloat(e);default:return e===n}}}},Imag.sort=function(e){var n=new I;return Object.keys(e).sort(function(e,n){return e.charCodeAt(0)-n.charCodeAt(0)}).forEach(function(t){n[t]=e[t]}),n},Imag.insert=function(e,n){Object.keys(n).forEach(function(t){e[t]?e[t]+=n[t]:e[t]=n[t],e[t]||delete e[t]})},Imag.clear=function(e){Object.keys(e).forEach(function(n){delete e[n]})},Imag.pow=function(e,n){Object.keys(e).forEach(function(t){n?e[t]*=n:delete e[t]})},Imag.akin=function(e,n){return Object.keys(e).toString()==Object.keys(n).toString()},Imag.equals=function(e,n){return JSON.stringify(e)==JSON.stringify(n)},Imag.empty=function(e){return 0==Object.keys(e).length},Imag.sortFunc=function(e,n){for(var t=Object.keys(e),r=Object.keys(n),i=Math.min(t.length,r.length),s=0;i>s;s++){if(t[s]<r[s])return-1;if(t[s]>r[s])return 1}var a=t.length-r.length;if(a)return a;for(var s=0;i>s;s++)if(a=e[t[s]]-n[r[s]])return a;return 0},Imag.strSortFunc=function(e,n){for(var t=Math.min(e.length,n.length),r=0;t>r;r++){if(e[r]<n[r])return-1;if(e[r]>n[r])return 1}return e.length-n.length},Imag.strSort=function(e){return e.split("").sort(function(e,n){return e.charCodeAt(0)-n.charCodeAt(0)}).reduce(function(e,n){return e+n},"")},Imag.strParse=function(e){for(var n=new I,t=0;t<e.length;t++){var r=e[t];n[r]?n[r]++:n[r]=1}return n},Imag.strValue=function(e){for(var n=1,t=0;t<e.length;t++)n*=e.charCodeAt(0);return n},Imag.len=function(e){return Object.keys(e).length},Imag.clone=function(e){return Object.keys(e).reduce(function(n,t){return n[t]=e[t],n},new I)},Imag.string=function(e){return Object.keys(e).reduce(function(n,t){var r=e[t];return n+(1==r?t:t+"^"+r)},"")},Lex.F={O:0,E:1,X:2,N:3,L:7},Lex.T=function(e,n){this.flag=e,this.code=n,this.inv=!1},Lex.G=function(e,n){this.exp=n,this.plu=e,this.test=function(e){return this.exp.test(e)}},Lex.SPAC=new Lex.G(!0,/^\s$/),Lex.BRAC=[new Lex.G(!1,/^\(|\[|\{$/),new Lex.G(!1,/^\)|\]|\}$/)],Lex.GRAM=[new Lex.G(!1,/^\+|\-|\*|\/$/),new Lex.G(!1,/^\^$/),new Lex.G(!1,/^[a-zA-Z]$/),new Lex.G(!0,/^[0-9]|\,|\.$/)],Lex.prep=function(e){return e=e.replace(/�/g,"^2"),e=e.replace(/�/g,"^3"),e=e.replace(/\u00B2/g,"^2"),e=e.replace(/\u00B3/g,"^3"),e=e.replace(/,/g,".")},Lex.iter=function(e){for(var n=[],t=this.prep(e).split("");t.length>0;){var r=0,i="";if(this.SPAC.test(t[0])){do t.shift();while(this.SPAC.test(t[0]))}else if(this.BRAC[0].test(t[0])){t.shift(),i="",r=this.F.L;for(var s=1,a="";s>0;){if(i+=a,0==t.length)throw")";a=t.shift(),s+=this.BRAC[0].test(a)?1:this.BRAC[1].test(a)?-1:0}n.push(new this.T(r,i))}else{for(;r<this.GRAM.length;){var u=this.GRAM[r];if(u.test(t[0]))do i=i.concat(t.shift());while(u.plu&&u.test(t[0]));i.length>0?(n.push(new this.T(r,i)),r=this.GRAM.length):r++}if(0==i.length)throw t.shift()}}return this.oper(n)},Lex.oper=function(e){var n=[],t=!1;for(var r in e){if(e[r].flag==this.F.O)switch(e[r].code){case"-":e[r].inv=!e[r].inv;case"+":break;case"/":t=!0;case"*":continue;default:throw"in `Lex.oper': Operator `"+e[r].code+"' has not been implemented."}else if(e[r].flag==this.F.E){if(0==n.length)throw"in `Lex.oper': Radix ahead `"+e[r].code+"' is undefined.";var i=n.pop();if(i.flag==this.F.O)throw"in `Lex.oper': Radix is not allowed to be an `"+i.code+"' operator.";e[r].code=i.code,e[r].inv=i.inv}else t&&(e[r].inv=!(t=!1));n.push(e[r])}return n},Lex.empty=function(e){for(var n=0;n<e.length;n++)if(!this.SPAC.test(e[n]))return!1;return!0},Seman.Q=function(e,n,t){this.fact=1,this.imag=new Object,this.sums=[],void 0!==e&&(this.fact*=e),void 0!==n&&(this.imag=n),void 0!==t&&(this.sums=t),this.calc=function(){return Seman.calcQ(this)},this.ident=function(){return Seman.identQ(this)},this.string=function(){return Seman.stringQ(this)},this.pow=function(e){return Seman.powQ(this,e)}},Seman.S=function(e,n,t){this.offset=0,this.queues=[],this.expont=null,void 0!==e&&(this.offset+=e),void 0!==n&&n.length>0&&(this.queues=n),void 0!==t&&(this.expont=t),this.calc=function(){return Seman.calc(this)},this.expand=function(){return Seman.expand(this),this},this.combine=function(){return Seman.combine(this)},this.expow=function(){return Seman.expow(this)},this.akinQ=function(){return Seman.akinS2Q(this)},this.ident=function(){return Seman.identS(this)},this.string=function(){return Seman.string(this)},this.simplify=function(e){return Seman.simplify(this,e)}},Seman.present=function(e){if("string"!=typeof e)throw"`Seman.present(string)' got `"+typeof e+"' instead of `string'";var n=Syntax.present(e);return this.represent(n)},Seman.represent=function(e){var n=new this.S;return e.forEach(function(e){var t=Seman.representQ(e);Seman.constQ(t)?n.offset+=t.fact:n.queues.push(t)}),this.solidify(n)},Seman.representQ=function(e){var n=new this.Q;return n.fact=e.fact.reduce(function(e,n){
return e*n},1),n.imag=Imag.strParse(e.imag),e.exps.forEach(function(e){var t=Seman.represent(e.radix),r=Seman.represent(e.power),i=t.expont;if(t.expont=r,i){var s=new Seman.S;t.expont=i,s.expont=r,s.queues.push(new Seman.Q(1,new I,[t])),t=s}n.sums.push(t),console.log(t.string())}),e.sums.forEach(function(e){var t=Seman.represent(e);n.sums.push(t)}),n},Seman.constQ=function(e){return 0==Imag.len(e.imag)&&0==e.sums.length},Seman.solidify=function(e){var n=e.expont?e.expont.calc():NaN;return 0!=e.offset||1!=e.queues.length||1!=e.queues[0].fact||0!=e.queues[0].sums||isNaN(n)?e.queues.forEach(function(e){return e.sums.map(function(e){return Seman.solidify(e)})}):(Imag.pow(e.queues[0].imag,n),e.expont=null),0!=e.offset||1!=e.queues.length||e.expont||1!=e.queues[0].fact||0!=Imag.len(e.queues[0].imag)||1!=e.queues[0].sums.length?e:this.solidify(e.queues[0].sums[0])},Seman.solidifyQ=function(e){return 1!=e.fact||0!=Imag.len(e.imag)||1!=e.sums.length||0!=e.sums[0].offset||e.sums[0].expont||1!=e.sums[0].queues.length?e:this.solidifyQ(e.sums[0].queues[0])},Seman.calc=function(e){var n=e.offset+e.queues.reduce(function(e,n){return e+Seman.calcQ(n)},0);return e.expont?Math.pow(n,this.calc(e.expont)):n},Seman.calcQ=function(e){return Object.keys(e.imag).length>0?NaN:e.fact*e.sums.reduce(function(e,n){return e*Seman.calc(n)},1)},Seman.akinS2Q=function(e){return e.expont?0==e.offset&&1==e.queues.length?!0:0!=e.offset&&0==e.queues.length:!1},Seman.powQ=function(e,n){return new this.Q(Math.pow(e.fact,n),Object.keys(e.imag).reduce(function(t,r){return t[r]=e.imag[r]*n,t},new I))},Seman.identS=function(e){return 0==e.offset&&null==e.expont&&e.queues.length?!e.queues.some(this.calcQ):!1},Seman.identQ=function(e){return e.fact*e.sums.reduce(function(e,n){return e*n.calc()},1)==1&&Imag.empty(e.imag)},Seman.string=function(e){var n=e.expont?!0:!1;return e.queues.reduce(function(e,n){var t=n.string();return e+(n.fact<0?t:"+"+t)},(n?"(":"")+e.offset)+(n?")^("+e.expont.string()+")":"")},Seman.stringQ=function(e){return e.sums.reduce(function(e,n){return e+"("+n.string()+")"},""+e.fact+Imag.string(e.imag))},Seman.clone=function(e){var n=new Seman.S;return n.offset=e.offset,n.queues=e.queues.map(Seman.cloneQ),n.expont=e.expont?Seman.clone(e.expont):null,n},Seman.cloneQ=function(e){var n=new Seman.Q;return n.fact=e.fact,n.imag=Imag.clone(e.imag),n.sums=e.sums.map(Seman.clone),n},Seman.simplify=function(e,n){do e=e.expand(),e=e.combine(),e=e.expow();while(--n>0);return e},Seman.expand=function(e){for(var n=0;n<e.queues.length;){var t=Seman.extract(e.queues[n]);if(Imag.clear(e.queues[n].imag),e.queues[n].fact=1,e.queues[n].ident()){if(t.expont)throw"`expand': `s0.expont' must be `null'.";e.queues.splice(n,1),e.offset+=t.offset,e.queues=t.queues.concat(e.queues),n+=t.queues.length}else 1!=t.calc()&&e.queues[n].sums.push(t),n++}},Seman.extract=function(e){for(var n=new this.S(0,[new this.Q(e.fact,Imag.clone(e.imag))]),t=0;t<e.sums.length;)this.expand(e.sums[t]),null==e.sums[t].expont?(n=this.expansion(n,e.sums[t]),e.sums.splice(t,1)):t++;return n},Seman.expansion=function(e,n){if(null!=e.expont)throw"`expansion': `s0.expont != null'";if(null!=n.expont)throw"`expansion': `s1.expont != null'";var t=e.offset*n.offset,r=e.queues.map(function(e){return new Seman.Q(n.offset*e.fact,Imag.clone(e.imag),e.sums)}).concat(n.queues.map(function(n){return new Seman.Q(e.offset*n.fact,Imag.clone(n.imag),n.sums)}));return e.queues.forEach(function(e){n.queues.forEach(function(n){var t=new I;Imag.insert(t,e.imag),Imag.insert(t,n.imag),r.push(new Seman.Q(e.fact*n.fact,Imag.sort(t),e.sums.concat(n.sums)))})}),new this.S(t,r.filter(function(e){return 0!=e.fact}))},Seman.combine=function(e){var n=e.offset,t=[],r=void 0,i=e.expont;return i&&(i=this.combine(e.expont)),e.queues.filter(function(e){var t=Seman.calcQ(e);return isNaN(t)?!0:(n+=t,!1)}).map(function(e){return Seman.combineQ(e),e}).sort(function(e,n){return-Imag.sortFunc(e.imag,n.imag)}).forEach(function(e){void 0!=r&&Imag.equals(r.imag,e.imag)&&0==r.sums.length&&0==e.sums.length?t[0].fact+=e.fact:(t.unshift(e),r=e)}),t=t.filter(function(e){return 0!=e.fact}),Seman.solidify(new this.S(n,t,i))},Seman.combineQ=function(e){var n,t,r,i=[];n=e.sums.reduce(function(e,n,t){n=n.combine(n);var r=n.expont;n.expont=null;var i=Seman.string(n);return n.expont=r,e[i]?e[i].push(t):e[i]=[t],e},new Object),t=Object.keys(n);for(var s=0;s<t.length;s++)r=n[t[s]],r.length>1&&(i=i.concat(this.combineE(e.sums,r)));i.sort(function(e,n){return n-e}).forEach(function(n){e.sums.splice(n,1)})},Seman.combineE=function(e,n){if(n.length<2)throw"`combineE': "+n.length+"/2 indices";var t=[],r=new this.S,i=new this.S;for(i.offset=e[n[0]].offset,i.queues=e[n[0]].queues;n.length;){var s=e[n[0]].expont;s?s.expont?r.queues.push(new this.Q(1,new I,[s])):(r.offset+=s.offset,r.queues=r.queues.concat(s.queues)):r.offset++,t.push(n[0]),n.splice(0,1)}return i.expont=r,e.push(i),t},Seman.expow=function(e){e=Seman.powerfy(e);var n=e.expont?e.expont.calc():NaN;if(isNaN(n))e.expont&&e.expont.expont;else{for(var t=[];n>1;){var r=new Seman.S;r.offset=e.offset,r.queues=e.queues.map(Seman.cloneQ),t.push(r),n--}e.expont=1==n?null:new Seman.S(n),t.length&&(t.unshift(e),e=new Seman.S,e.queues.push(new Seman.Q(1,new I,t)))}return e.queues.forEach(function(e){e.sums=e.sums.map(Seman.expow)}),Seman.solidify(e)},Seman.powerfy=function(e){if(0==e.offset&&1==e.queues.length&&e.expont){for(var n=e.expont,t=e.queues[0],e=new this.S(0,[t]),r=0;r<t.sums.length;r++)t.sums[r].expont=Seman.expansion(t.sums[r].expont,Seman.clone(n));var i=n.calc();isNaN(i)?(t.sums.push(new this.S(t.fact,t.imag,Seman.clone(n))),t.fact=1,t.imag=new I):(t.fact=Math.pow(t.fact,i),Imag.pow(t.imag,i))}return e},Seman.concatS=function(e,n){return new this.S(e.offset+n.offset,e.queues.concat(n.queues))},Syntax.Q=function(){this.fact=[],this.imag="",this.exps=[],this.sums=[]},Syntax.E=function(){this.radix=[],this.power=[]},Syntax.present=function(e){if("string"!=typeof e)throw"`Syntax.present(string)' got `"+typeof e+"' instead of `string'";var n=Lex.iter(e),t=[];do{for(var r=!1;n.length>0&&n[0].flag==Lex.F.O;)n.shift().inv&&(r=!r);var i=this.pluckQ(n);i&&(r&&i.fact.unshift(-1),t.push(i))}while(n.length>0);return this.sort(t),t},Syntax.pluckQ=function(e){for(var n=new this.Q;e.length>0;)switch(e[0].flag){case Lex.F.N:var t=parseFloat(e[0].code);if(e.shift().inv){if(0==t)throw"`pluckQ' divided by 0.";t=1/t}n.fact.push(t);break;case Lex.F.X:var r=e[0].code;if(e.shift().inv){var i=new this.E;i.radix.push(this.X2Q(r)),i.power.push(this.N2Q(-1)),n.exps.push(i)}else n.imag+=r;break;case Lex.F.E:var i=new this.E;if(e[0].inv)throw"`pluckQ' Token `"+e[0]+"' is not allowed to be `inv'";i.radix=this.present(e.shift().code),i.power=this.pluckT(e),n.exps.push(i);break;case Lex.F.L:var s=this.present(e[0].code);if(e.shift().inv){var i=new this.E;i.radix=s,i.power.push(this.N2Q(-1)),n.exps.push(i)}else n.sums.push(s);break;case Lex.F.O:default:return this.emptyQ(n)?null:n}return this.emptyQ(n)?null:n},Syntax.pluckT=function(e){if(!(e.length>0))throw"`pluckT' without any token.";switch(e[0].flag){case Lex.F.N:return[this.N2Q(e.shift().code)];case Lex.F.X:return[this.X2Q(e.shift().code)];case Lex.F.E:var n=new this.E;if(e[0].inv)throw"`pluckT' Token `"+e[0]+"' is not allowed to be `inv'";return n.radix=this.present(e.shift().code),n.power=this.pluckT(e),[this.E2Q(n)];case Lex.F.L:return this.present(e.shift().code);case Lex.F.O:throw"`pluckT' invalid `flag=O'.";default:throw"`pluckT' invalid `flag=?'."}},Syntax.clean=function(e){e.forEach(Syntax.cleanQ)},Syntax.cleanQ=function(e){e.sums.forEach(Syntax.clean),e.exps.forEach(function(e){Syntax.clean(e.radix),Syntax.clean(e.power)});for(var n=0;n<e.exps.length;){var t=e.exps[n];1==t.radix.length&&1==t.power.length&&0==t.radix[0].fact.length&&t.radix[0].imag.length&&0==t.radix[0].exps.length&&0==t.radix[0].sums.length&&1==t.power.length&&1==t.power[0].fact.length&&!t.power[0].imag.length&&0==t.power[0].exps.length&&0==t.power[0].sums.length?e.exps.splice(n,1):n++}},Syntax.N2Q=function(e){var n=new this.Q;return n.fact.push(e),n},Syntax.X2Q=function(e){var n=new this.Q;return n.imag=e,n},Syntax.E2Q=function(e){var n=new this.Q;return n.exps.push(e),n},Syntax.sort=function(e){e.forEach(function(e){Syntax.sortQ(e)}),e.sort(function(e,n){return Imag.strSortFunc(e.imag,n.imag)})},Syntax.sortQ=function(e){e.sums.forEach(function(e){Syntax.sort(e)}),e.fact.sort(function(e,n){return e-n}),e.imag=Imag.strSort(e.imag),e.exps.sort(function(e,n){return Syntax.valueE(e)-Syntax.valueE(n)}),e.sums.sort(function(e,n){return Syntax.value(e)-Syntax.value(n)})},Syntax.value=function(e){return e.reduce(function(e,n){return e+Syntax.valueQ(n)},0)},Syntax.valueE=function(e){return Math.pow(16536421.3572347+this.value(e.radix),this.value(e.power))},Syntax.valueQ=function(e){return e.fact.reduce(function(e,n){return e*n},1)*Imag.strValue(e.imag)*e.exps.reduce(function(e,n){return e*Syntax.valueE(n)},1)*e.sums.reduce(function(e,n){return e*Syntax.value(n)},1)},Syntax.emptyQ=function(e){return 0==e.fact.length&&0==e.imag.length&&0==e.exps.length&&0==e.sums.length},Syntax.string=function(e){var n="";if(e.length){n+=this.stringQ(e[0]);for(var t=1;t<e.length;t++){var r=e[t].fact.reduce(function(e,n){return e*n},1),i=this.stringQ(e[t]);n+=0>r?i:"+"+i}}return n},Syntax.stringQ=function(e){var n="";if(e.fact.length){n+=e.fact[0];for(var t=1;t<e.fact.length;t++)n+="*"+e.fact[t]}return n+=e.imag,n+=e.exps.reduce(function(e,n){return e+Syntax.stringE(n)},""),n+=e.sums.reduce(function(e,n){return e+"("+Syntax.string(n)+")"},"")},Syntax.stringE=function(e){return"("+Syntax.string(e.radix)+")^("+Syntax.string(e.power)+")"};